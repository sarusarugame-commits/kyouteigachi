name: run-bot

on:
  # â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œè¨­å®š (UTCæ™‚é–“ã§æŒ‡å®š)
  # æ—¥æœ¬æ™‚é–“ 8:00 (UTC 23:00) ã‹ã‚‰ 22:00 (UTC 13:00) ã¾ã§ã€30åˆ†ãŠãã«å®Ÿè¡Œ
  # â€»ç«¶è‰‡ã®ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°(8:30é ƒ)ã€œãƒŸãƒƒãƒ‰ãƒŠã‚¤ãƒˆ(21:40é ƒ)ã‚’ã‚«ãƒãƒ¼ã—ã¾ã™
  schedule:
    - cron: '*/30 23,0-13 * * *'

  # ğŸ‘† æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹ãƒœã‚¿ãƒ³ã‚‚æ®‹ã—ã¦ãŠã
  workflow_dispatch:

jobs:
  run-race-prediction:
    runs-on: ubuntu-latest
    timeout-minutes: 60 # å¿µã®ãŸã‚60åˆ†ã§å¼·åˆ¶çµ‚äº†ï¼ˆãƒ•ãƒªãƒ¼ã‚ºå¯¾ç­–ï¼‰

    steps:
      # 1. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’GitHubã‹ã‚‰å–å¾—
      - uses: actions/checkout@v4
      
      # 2. Python 3.10 ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # æ¬¡å›ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é«˜é€ŸåŒ–
      
      # 3. å¿…è¦ãªãƒ„ãƒ¼ãƒ«(ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy lightgbm requests beautifulsoup4 google-generativeai discordwebhook

      # 4. Botã‚’èµ·å‹• (APIã‚­ãƒ¼ãªã©ã¯GitHubã®Secretsã‹ã‚‰èª­ã¿è¾¼ã‚€)
      - name: Run Main Script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: python main.py
