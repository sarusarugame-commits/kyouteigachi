name: run-bot

on:
  # â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ (UTCæ™‚é–“ã§æŒ‡å®š)
  # JST 08:00 (UTC 23:00) ã‹ã‚‰ JST 21:30 (UTC 12:30) ã¾ã§ 30åˆ†ãŠãã«å®Ÿè¡Œ
  # ã“ã‚Œãªã‚‰å¤œ22æ™‚ä»¥é™ã«é€šçŸ¥ãŒæ¥ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  schedule:
    - cron: '*/30 23,0-12 * * *'

  # ğŸ‘† æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹ãƒœã‚¿ãƒ³ã‚‚æ®‹ã—ã¦ãŠã
  workflow_dispatch:

jobs:
  run-race-prediction:
    runs-on: ubuntu-latest
    timeout-minutes: 60 # ãƒ•ãƒªãƒ¼ã‚ºå¯¾ç­–ï¼ˆ60åˆ†ã§å¼·åˆ¶çµ‚äº†ï¼‰

    steps:
      # 1. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
      - uses: actions/checkout@v4
      
      # 2. Python 3.10 ã‚’æº–å‚™
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
      
      # 3. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy lightgbm requests beautifulsoup4 google-generativeai discordwebhook

      # 4. Botã‚’å®Ÿè¡Œ (ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€)
      - name: Run Main Script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: python main.py
